name: API Testing with Newman and JSON Server

on:
  push:
    branches: [ main ] 

jobs:
  test-api:
    runs-on: ubuntu-latest 

    steps:
      - name: Checkout code
        uses: actions/checkout@v3 

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18' 

      - name: Install Newman and JSON Server
        run: npm install -g newman json-server 

      - name: Start JSON Server
        run: json-server --watch Students.json & 
        
      - name: Wait for JSON Server
        run: sleep 5 

      - name: Run Newman Tests
        run: |
          newman run "chaining Students collection.postman_collection.json" \
          -e "stage.postman_environment.json" \
          --reporters cli